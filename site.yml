# ===============================================================================
# This is the main site-wide playbook. It includes common provisioning tasks
# as well as individual system playbooks for specific server roles.
# USE WITH CAUTION: Modifying this file can impact the entire infrastructure.
# It's the whole magilla.

---

# Common Server Provisioning
- name: Ubuntu 24.04 Common Provisioning Tasks
  hosts: linux_servers
  gather_facts: true
  become: true
  roles:
    - role: provision_ubuntu_2404
      when:
        - ansible_distribution == "Ubuntu"
        - ansible_distribution_version == "24.04"
      tags: [provision, system]

# Docker Provisioning
- name: Docker Provisioning Tasks
  hosts: docker
  gather_facts: true
  become: true
  roles:
    - role: docker_engine
      tags: [provision, docker]

# Pi-hole Deployment
- name: Deploy pihole-01 and pihole-02
  hosts: pihole
  become: true
  roles:
    - role: pihole_v6
      tags: [infra, services, dns]

# Nebula Sync Deployment
- name: Deploy nebula-sync on infrastructure-01
  hosts: infrastructure-01
  gather_facts: true
  become: true
  roles:
    - role: nebula_sync
      tags: [infra, services, dns]

# Paperless Deployment
- name: Deploy Paperless-ngx Document Management Stack
  hosts: paperless-01
  gather_facts: true
  become: true
  roles:
    - role: paperless_stack
      tags: [paperless, document_management]

# Notification Stack Deployment
- name: Deploy Notification Stack (Apprise + Mailrise)
  hosts: notification_stack
  gather_facts: true
  become: true
  roles:
    - role: notification_stack
      tags: [notifications, mailrise, apprise]

# Homepage Deployment
- name: Deploy Homepage Dashboard
  hosts: homepage
  gather_facts: true
  become: true
  roles:
    - role: homepage
      tags: [homepage, dashboard]

# Zulip Deployment
- name: Deploy Zulip Chat
  hosts: zulip
  gather_facts: true
  become: true
  roles:
    - role: zulip
      tags: [zulip, chat]

# Monitoring Stack Deployment
- name: Deploy Monitoring Stack (Prometheus + Grafana + Loki)
  hosts: monitoring_stack
  gather_facts: true
  become: true
  roles:
    - role: monitoring_stack
      tags: [monitoring, prometheus, grafana, loki]
